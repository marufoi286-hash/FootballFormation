# 要件定義書 (Requirements Definition)

## 1. プロジェクト概要
* **プロジェクト名**: サッカーフォーメーション管理アプリ 
* **目的**: 社会人サッカーチームにおける戦術共有・メンバー管理の効率化。
* **コンセプト**: 「スマホで完璧に使える」「書類（PDF）として管理できる」「チーム全員が簡単に共有できる」。
* **ドメイン**: `sonosonotech28.com`

## 2. ターゲットユーザー
* **メインユーザー**: 社会人サッカーチームの代表者、監督、キャプテン。
* **エンドユーザー**: チームメンバー（閲覧・戦術確認）。
* **利用シーン**:
    * 試合前日〜当日：スマホでメンバー配置、戦術共有、交代策のメモ。
    * 試合後：PDF出力して記録保存、振り返り。

## 3. 機能要件

### 3.1 認証・権限管理
* **認証方式**: チームID ＋ 共通パスワード（1チーム1アカウント共有方式）。
* **権限**:
    * **ログインユーザー**: フォーメーションの作成、編集、保存、削除、PDFダウンロードが可能。
    * **ゲスト（URL閲覧者）**: 共有されたURL経由での閲覧のみ可能（編集不可）。
* **競合制御**: Last Win（後勝ち）。排他制御は行わず、最後に保存ボタンを押したユーザーの内容で上書きされる。

### 3.2 試合・フォーメーション管理
* **データ構造（階層）**:
    * `チーム` > `試合` > `フォーメーション` の3階層で管理する。
* **試合 (Match)**:
    * 対戦相手、日付、場所情報を保持するフォルダとして機能する。
* **フォーメーション (Formation)**:
    * 1つの試合に対し、複数のフォーメーションを作成可能。
    * **区分**: 「前半」「後半」「Option」などのラベルを付けられる。
    * **メモ機能**: 各フォーメーションに対し、交代タイミングや戦術指示（例：「後半15分 田中OUT 鈴木IN」）をテキストで記録できる。
* **競技人数**: 11人制固定。
* **メンバー管理**:
    * **マスタ管理**: チームメンバーを登録・編集・削除可能。
    * **データ参照**: フォーメーション上の選手はマスタデータを参照する（マスタ側で改名すると、過去のフォーメーション表示名も更新される）。
    * **ゲスト選手（助っ人）**: マスタ未登録の選手も配置可能。デフォルト名はポジション名（例：「FW」「MF」）とし、任意の名前に編集可能。
    * **ベンチ入り**: 最大20名まで。

### 3.3 UI/UX・操作性
* **スマホ最適化**:
    * **編集モード**: **「縦画面（Portrait）」**推奨。画面下部のメンバーリストから上部のピッチへドラッグ＆ドロップで配置。
    * **閲覧モード**: **「横画面（Landscape）」**推奨。ピッチ全体を大きく表示。
* **配置操作**:
    * ドラッグ＆ドロップ対応（スマホタッチ操作に最適化）。
    * ピッチ座標系：100x100の相対座標で保存し、画面サイズごとの崩れを防ぐ。
* **保存**: 手動保存（「保存」ボタン押下時のみDB更新）。

### 3.4 出力機能
* **共有**: 保存時に一意のURLを発行。URLを知っているメンバーはログイン不要で閲覧可能。
* **PDFダウンロード**:
    * 作成した試合データ（前後半のフォーメーション図＋メンバーリスト＋交代メモ）をPDFファイルとして生成・ダウンロード可能。
    * 技術：.NETバックエンド側でPuppeteerSharpを使用し、HTMLからPDFをレンダリング。

## 4. 非機能要件

### 4.1 インフラ・アーキテクチャ
* **クラウド**: Google Cloud Platform (GCP)
* **構成**:
    * **Frontend**: Firebase Hosting または Cloud Storage + Load Balancer (Vue.js SPA)
    * **Backend**: **Cloud Run** (.NET Core Web API コンテナ)
        * ※サーバーレスコンテナ。PuppeteerSharp動作に必要なライブラリを含むDockerイメージをデプロイ。
        * ※リクエストがない時はインスタンス数を0にしてコストを削減可能。
    * **Database**: **Cloud SQL** (PostgreSQL)
* **CI/CD**:
    * GitHub Actions または Cloud Build を使用。
    * Frontend: ビルド → Firebase Hosting へデプロイ。
    * Backend: Dockerイメージビルド → **Artifact Registry** へプッシュ → Cloud Run サービス更新。

### 4.2 パフォーマンス・制約
* **レスポンス**: スマホ回線（4G/5G）でもストレスなく動作すること。
* **スケーラビリティ**:
    * 初期フェーズ：Cloud Runのオートスケール機能を活用し、少人数から将来のスパイクアクセスまで自動対応。
    * 将来フェーズ：マルチテナント（100チーム以上）対応を見据え、TeamIdによるデータ分離を徹底したDB設計とする。